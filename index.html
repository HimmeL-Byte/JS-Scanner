<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JS Obfuscation Scanner</title>
  <style>
    body {
      font-family: monospace;
      background-color: #1e1e1e;
      color: #eee;
      padding: 30px;
    }
    .container {
      max-width: 960px;
      margin: auto;
      background: #2b2b2b;
      padding: 25px;
      border-radius: 10px;
    }
    h2 { color: #46ff06; }
    input[type="file"] {
      background: #444;
      padding: 10px;
      margin: 10px 0;
      color: white;
      border: none;
    }
    .match {
      background: #333;
      border-left: 5px solid #46ff06;
      padding: 10px;
      margin: 10px 0;
    }
    .loader {
      display: none;
      margin: 15px auto;
      width: 30px;
      height: 30px;
      border: 4px solid #444;
      border-top: 4px solid #46ff06;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    code {
      background: #1e1e1e;
      padding: 2px 5px;
      border-radius: 4px;
      color: #ffd700;
    }
  </style>
</head>
<body>
<div class="container">
  <h2>ðŸ§ª Obfuscated JS Scanner</h2>
  <input type="file" id="fileInput" accept=".js">
  <div class="loader" id="loader"></div>
  <div id="output"></div>
</div>

<script>
const patterns = [
  { name: "API Key", regex: /api[_-]?key['"]?\s*[:=]\s*['"`]?[A-Za-z0-9_\-]{16,}['"`]?/gi },
  { name: "Access Token", regex: /access[_-]?token['"]?\s*[:=]\s*['"`]?[A-Za-z0-9\-_.=]{16,}['"`]?/gi },
  { name: "JWT", regex: /eyJ[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+\.[A-Za-z0-9\-_]+/g },
  { name: "AWS Key", regex: /AKIA[0-9A-Z]{16}/g },
  { name: "AWS Secret", regex: /['"`][A-Za-z0-9\/+=]{40}['"`]/g },
  { name: "Stripe Key", regex: /(sk|pk)_(live|test)_[0-9a-zA-Z]{20,}/g },
  { name: "Hardcoded Password", regex: /password['"]?\s*[:=]\s*['"`][^'"`]{4,}['"`]/gi },
  { name: "Secret", regex: /secret['"]?\s*[:=]\s*['"`][^'"`]+/gi },
  { name: "Base64 Encoded", regex: /['"][A-Za-z0-9+/=]{32,}['"]/g },
  { name: "Firebase Config", regex: /firebaseConfig\s*=\s*{[\s\S]*?}/gi },
  { name: "Internal URL", regex: /url\s*[:=]\s*["']\/[a-z0-9\/\?\=\&\-_\.]+["']/gi }
];

function decodeHex(str) {
  return str.replace(/\\x([0-9A-Fa-f]{2})/g, (_, hex) =>
    String.fromCharCode(parseInt(hex, 16))
  );
}

function extractConcatenatedStrings(str) {
  return str.replace(/(['"`])([^'"`]+?)\1\s*\+\s*\1([^'"`]+?)\1/g, (_, q, a, b) => q + a + b + q);
}

function extractAtobStrings(str) {
  const b64Regex = /atob\s*\(\s*['"`]([A-Za-z0-9+/=]{32,})['"`]\s*\)/gi;
  let decoded = str;
  let match;
  while ((match = b64Regex.exec(str)) !== null) {
    try {
      decoded += "\n" + atob(match[1]);
    } catch (e) {}
  }
  return decoded;
}

function scanContent(originalContent) {
  const decodedHex = decodeHex(originalContent);
  const concatMerged = extractConcatenatedStrings(decodedHex);
  const withAtobDecoded = extractAtobStrings(concatMerged);

  const scanTargets = [originalContent, decodedHex, concatMerged, withAtobDecoded];
  const found = [];

  scanTargets.forEach(scanText => {
    patterns.forEach(({ name, regex }) => {
      let match;
      while ((match = regex.exec(scanText)) !== null) {
        found.push({ name, value: match[0] });
      }
    });
  });

  return found;
}

document.getElementById("fileInput").addEventListener("change", async (e) => {
  const file = e.target.files[0];
  const loader = document.getElementById("loader");
  const output = document.getElementById("output");

  output.innerHTML = '';
  loader.style.display = 'block';

  const text = await file.text();
  const matches = scanContent(text);

  loader.style.display = 'none';

  if (matches.length === 0) {
    output.innerHTML = "<p>âœ… Tidak ditemukan informasi sensitif dalam file JS.</p>";
  } else {
    matches.forEach(m => {
      output.innerHTML += `<div class="match"><b>${m.name}</b>: <code>${m.value}</code></div>`;
    });
  }
});
</script>
</body>
</html>
