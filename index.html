<?php
ini_set('max_execution_time', 900);
error_reporting(0);
ob_implicit_flush(true);

function strip_carriage_returns($string) {
    return str_replace(["\n\r", "\n", "\r"], '', $string);
}

function GetBetween($content,$start,$end){
    $r = explode($start, $content);
    if (isset($r[1])){
        $r = explode($end, $r[1]);
        return $r[0];
    }
    return '';
}

function forceFlush() {
    ob_start(); 
    ob_end_clean(); 
    flush(); 
    ob_end_flush(); 
}

function scanFile($content, $filename) {
    echo "<div class='card'>";
    echo "<h3>üîç $filename</h3>";

    $patterns = [
        '/(api_key\s*[:=]\s*[\'"][a-z0-9_\-]{16,}[\'"])/i',
        '/(apikey\s*[:=]\s*[\'"][a-z0-9_\-]{16,}[\'"])/i',
        '/(apiKey\s*[:=]\s*[\'"][a-z0-9_\-]{16,}[\'"])/i',
        '/(secret\s*[:=]\s*[\'"][a-z0-9_\-]{16,}[\'"])/i',
        '/(accessKeyId\s*[:=]\s*[\'"]AKIA[a-zA-Z0-9]{16}[\'"])/',
        '/(secretAccessKey\s*[:=]\s*[\'"][a-zA-Z0-9\/+=]{40,}[\'"])/',
        '/(password\s*[:=]\s*[\'"].{6,}[\'"])/i',
        '/(Authorization\s*[:=]\s*[\'"]Bearer\s+[a-zA-Z0-9\._\-]+[\'"])/i',
        '/(firebaseConfig\s*[:=]\s*{)/i',
        '/(jwt.*secret\s*[:=]\s*[\'"].+?[\'"])/i',
        '/(url\s*[:=]\s*[\'"]\/[a-z0-9\/\-\_\?&=]+[\'"])/i'
    ];

    $found = false;
    foreach ($patterns as $regex) {
        if (preg_match_all($regex, $content, $matches)) {
            foreach ($matches[0] as $match) {
                echo "<div class='result'>‚ö†Ô∏è ".htmlentities($match)."</div>";
                $found = true;
            }
        }
    }

    if (!$found) {
        echo "<div class='result safe'>‚úÖ Tidak ditemukan indikasi info sensitif.</div>";
    }

    echo "</div>";
    forceFlush();
}

if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['jsfile'])) {
    $file = $_FILES['jsfile'];
    if ($file['type'] === "application/javascript" || str_ends_with($file['name'], '.js')) {
        $content = file_get_contents($file['tmp_name']);
        ?>
        <!doctype html>
        <html>
        <head>
            <meta charset="utf-8">
            <title>JS Scanner - Results</title>
            <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
            <style>
                body { font-family: 'Inter', sans-serif; background: #f4f4f4; padding: 30px; color: #333; }
                .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
                .result { padding: 6px 10px; background: #fff6e6; border-left: 4px solid #ffa500; margin: 5px 0; border-radius: 6px; }
                .result.safe { background: #e8f5e9; border-left-color: #4caf50; }
                h3 { margin-bottom: 10px; }
                a.back { display: inline-block; margin-top: 20px; color: #007BFF; text-decoration: none; }
                a.back:hover { text-decoration: underline; }
            </style>
        </head>
        <body>
        <h2>üìÑ Scan Result</h2>
        <?php scanFile($content, htmlentities($file['name'])); ?>
        <a class="back" href="index.php">‚¨ÖÔ∏è Kembali</a>
        </body>
        </html>
        <?php
        exit;
    } else {
        echo "File bukan .js!";
        exit;
    }
}
?>

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>JS Info Disclosure Scanner</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f9f9f9;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
      padding: 20px;
    }

    .container {
      background-color: white;
      padding: 30px 40px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      text-align: center;
      max-width: 500px;
    }

    h1 {
      margin-bottom: 20px;
      font-size: 26px;
    }

    input[type="file"] {
      padding: 10px;
      font-size: 16px;
    }

    button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background-color: #3b82f6;
      color: white;
      cursor: pointer;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #2563eb;
    }

    #loader {
      display: none;
      margin-top: 20px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 5px solid #ddd;
      border-top: 5px solid #3b82f6;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<div class="container">
  <h1>üîê JS Info Disclosure Scanner</h1>
  <form id="scanForm" method="POST" enctype="multipart/form-data">
    <input type="file" name="jsfile" accept=".js" required>
    <br>
    <button type="submit">üîé Scan Sekarang</button>
  </form>
  <div id="loader">
    <div class="spinner"></div>
    <p>Sedang menganalisis file...</p>
  </div>
</div>

<script>
  document.getElementById('scanForm').addEventListener('submit', function() {
    document.getElementById('loader').style.display = 'block';
  });
</script>
</body>
</html>
